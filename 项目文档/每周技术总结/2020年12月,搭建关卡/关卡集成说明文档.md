# 关卡集成说明文档



## 关卡分布



#### 关卡分布总览



* 挑战模式:301-400(关卡号)

  301-340是避障关卡,341-380是航路规划关卡,381-390是侦察探雷关卡,391-400是对抗关卡

* 训练模式:401-610

  401-500是避障关卡,501-600是航路规划关卡,601-610是对抗关卡

 

 

### 挑战模式

301-340是避障关卡,341-380是航路规划关卡,381-390是侦察探雷,391-400是对抗关卡

 

#### 301-340避障关卡

100个避障关卡的前40个关卡:想定101-140, 8个地图:433-440,每个地图对应5个想定

 

#### 341-380航路规划关卡

想定是211-214,一个想定对应10个地图



* 10个5*5关卡:地图501-510,想定211

* 10个10*10关卡:地图521-531(不包括526),想定212

* 10个12*12关卡:地图542-551,想定213

* 10个15*15关卡:地图564-573,想定214



#### 381-390 侦察探雷关卡

第51-60个避障关卡:想定151-160 地图:443和444,每个地图对应5个想定

 

#### 391-400 对抗关卡(保护固定目标,保护移动目标)

由于是一边训练一边搭建关卡,根据训练结果的反馈调整搭建关卡的思路,所以顺序比较乱,一共10个对抗关卡



关卡    想定    地图

391     216     526

392     217     526

393     225     607

394     218     552

395     219     552

396     221     552

397     220     558

398     223     605

399     226     605

400     222     604

 

### 训练模式
#### 401-500避障的100个关卡



想定101-160 171-210 地图和想定绑定

地图分为5个区域,m1-m5,每个区域有4个地图,分别是5\*5,10\*10,15\*15,20\*20大小,一共20个地图

每张地图对应5个想定,一共100个想定

 

#### 501-600航路规划的100个关卡



想定是211,212,213,214,215 地图是:501-583(不包括526,552,558)

想定只有五个,5\*5,10\*10,12\*12,15\*15,20\*20大小各一个

每个想定对应20个地图,一共100张地图

 

#### 601-610对抗关卡(保护固定目标,保护移动目标)

想定:216-226(不包括224),地图:526,552,558,604,605,606,607

 

## 命名规则

地图,想定和环境id命名规则解释(默认下划线”_”用来分隔不同的部分)



#### 地图命名规则



#### 以m开头

例:

m1_5\*5  m表示区域(区域指地图上的某一小块区域,例如:三沙群岛及附近海域可表示一块区域),m1表示区域1,5\*5表示地图大小是5\*5

m1_5\*5的含义是:m1区域里的一个5\*5大小地图

m2_10\*10的含义是:m2区域里的一个10\*10大小地图



另外,m开头的地图同样代表了避障关卡

 

#### 以RP开头

例:

RP_5\*5_1 RP表示Route planning航路规划, 5\*5表示地图大小是5\*5,1表示地图的序号

RP_5\*5_1的含义是:航路规划的第一个5\*5大小地图,

RP_10\*10_1的含义是:航路规划的第一个10\*10大小地图

 

#### 以F开头

例:

F_5\*5_1 F表示Fight对抗,5\*5表示地图大小,1表示地图的序号

F_5\*5_1的含义是:对抗关卡的第一个5\*5大小地图

 

另外,F后跟数字可以区分对抗关卡的类型

例:

F_5\*5_1表示保护固定目标关卡的地图

F2_5\*5_1 表示保护移动目标关卡的地图

 

### 想定命名规则

例:

m1_5\*5_s1 m与地图中m的含义一致,表示区域(也表示避障关卡),5\*5表示地图大小,s1表示想定(scenario)1,RP,F及 * 的含义与之前一致,不再赘述

m1_5\*5_s1的含义是: m1_5\*5地图的想定1

m1_10\*10_s1的含义是: m1_10\*10地图的想定1

 

RP_5的含义是:航路规划关卡5\*5大小地图的想定

 

F_5\*5_1_s1v1 s1v1表示红方(算法控制)一艘无人艇vs蓝方(脚本控制)一艘无人艇的想定

F_5\*5_1_s1v1的含义是:对抗关卡的5\*5大小地图上的1(红)v1(蓝)想定

另外, s1v1_2后面的2表示同样地图下的第二个1v1想定,默认情况下为1

 

### 环境id命名规则

环境id的命名和想定的命名紧密联系,一般是直接在想定名称后面加上”-v0”,但有例外

例:

想定       环境id

m1_5\*5_s1   m1_5\*5_s1-v0

RP_5       RP_5-v0

 

对抗关卡的环境id命名中, s + 数字 表示想定及想定的序列号(也就是说是第几个想定)

 

##### 如果状态空间完全一致,相同地图的不同想定可以使用相同的环境,所以不做区分,

例:

F_5\*5_1_s1v1     F_5\*5_1_s1-v0

F_5\*5_1_s1v1_2   F_5\*5_1_s1-v0

想定F_5*5_1_s1v1和想定F_5\*5_1_s1v1_2使用相同的环境F_5*5_1_s1-v0

 

##### 如果状态空间不一致,相同地图的不同想定就按照想定创建的顺序按序号区分,如:s1表示创建的第一个想定,s2表示创建的第二个想定

例:

F_15\*15_1_s3v8   F_15\*15_1_s1-v0

F_15\*15_1_s1v1   F_15\*15_1_s2-v0

想定F_15\*15_1_s3v8第一个创建,所以环境id是F_15\*15_1_s1-v0,

想定F_15\*15_1_s1v1第二个创建,所以环境id是F_15\*15_1_s2-v0

 

 

### 模型解释

总共10个对抗关卡训练好了8个模型,模型是一个.zip压缩文件,存储训练出来的参数信息

一般有2-3个版本,v0,v1或v0,v1,v2

v0表示刚刚开始训练时的模型,v1表示中间过程模型或最终结果模型,v2表示最终结果模型

 

### train.py 和 play.py重要参数解释

例:

train.py -u http://127.0.0.1:9999/common/queryScore -i 3 -c 关卡号 -a PPO -v

GYMID -m 模型名 -d 日志名 -s 单次训练步数 -t 训练次数

 

关卡号指定训练的关卡,是数据库中关卡的主键

GYMID指定算法所需的环境,是算法找到环境的依据

模型名表示模型的文件名,也就是训练结果保存的参数文件名,算法在保存的时候会自动添加”.zip”后缀,一般与GYMID相同

日志是一个文件夹,记录算法的训练过程,一般命名为 模型名_tensorboard

单次训练步数指定一次learn的step数,同时每经过改次数就会save一次模型

训练次数指定循环的次数,也就是训练的次数, 单次训练步数 * 训练次数 就是总的训练step数

 

play.py -u 1 -i 1 -c 关卡号 -a PPO -v GYMID -m 模型名 -t play次数

play次数指展示的次数



## 收获总结



* 做之前先规划好要做的东西
  * 规划好文件分布,哪个文件夹放哪些文件,有什么作用
  * 规划好文件命名,文件的命名要有可扩展性,易读性
  * 对应用在多个地方的规则,如命名规则,要写说明文件加以说明
  * 规划好的东西,可以先把框架做出来,如先建好文件结构
* 对于重复性的工作,尽可能让其自动化完成,如果不能就建立一个模板,把需要重复修改的东西在模板里修改好
  * 同时要对模板进行注释说明,把模板的注释写好了,每个文件的注释就写好了


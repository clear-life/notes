# 类设计者的工具

## 第 13 章 拷贝控制

### 13.1 拷贝, 赋值与销毁

#### 13.1.1 拷贝构造函数

拷贝构造函数: **构造函数**的**第一个参数是自身类型的引用**, 且**其余参数都有默认值**

```C++
class Class
{
public:
	Class();				// 默认构造函数
	Class(const Class&);	// 拷贝构造函数
};
```

> 拷贝构造函数会被隐式使用, 所以不能是 explicit

**合成拷贝构造函数**

如果未定义拷贝构造函数, 编译器会自动定义一个合成拷贝构造函数

合成拷贝构造函数拷贝每个非 static 成员

```C++
class Class
{
public:
	Class(const Class&);
private:
    string s;
    int a;
    double b;
}
// 与合成拷贝构造函数等价的自定义的拷贝构造函数
Class::Class(const Class& that):
	s(that.s), 				// string 类的拷贝调用 string 的拷贝构造函数
	a(that.a), b(that.b)	// 内置类型直接拷贝
    {	}
```

**拷贝初始化**

```C++
string s(5, 'c');			// 直接初始化, 调用构造函数
string s(s2);				// 直接初始化, 调用构造函数
string s = s2;				// 拷贝初始化, 通常调用拷贝构造函数
string s = "hello";			// 拷贝初始化, 通常调用拷贝构造函数
string s = string(5, 'c');	// 拷贝初始化, 通常调用拷贝构造函数
```

> 直接初始化用构造函数初始化, 相当于 emplace_back
>
> 拷贝初始化

拷贝初始化发生情况

* 用 `=` 定义变量
* 传递参数时值传递
* 返回结果时值返回
* 用花括号列表初始化数组元素或聚合类成员

> insert 或 push 	拷贝初始化
>
> emplace 		     直接初始化


# 哈希表

## 概念

哈希函数为核心的数据结构, 支持 **O(1) 插入与查询**

**哈希函数 f** : 将元素映射到槽上

> 元素: 自变量 x
>
> 槽: 因变量 y (其实是槽的下标)

**冲突**: 不同的 x 映射到相同的 y

**装载因子**: 定义域的大小 n 与值域的大小 m 的比值

$\alpha = n / m$

解决冲突的办法: 

1. **链接法**

   每个 y 有一个链表, 里面存放所有 $f(x) = y$ 的 $x$, y 对应的值就是链表的表头

   > 链表的平均长度就是装载因子的大小

2. **开放寻址法**

   所有元素存在槽里, 发生冲突时, 就往下一个槽移动, 直到能放下为止

> 尽可能用质数做模, 可以减少冲突
>
> 常用质数
>
> 1e5 + 3
> 2e5 + 3
> 3e5 + 7

**时间复杂度**

插入 $O(1)$

查找 $O(1 + \alpha)$

删除 $O(1 + \alpha)$

> 优化, 每个链表可以优化为平衡二叉搜索树, 可以在 $O(\log n)$ 时间内找到元素
>
> 但插入操作也变为 $O(\log n)$
>
> 使用平衡二叉搜索树后, 插入, 查找, 删除都是 $O(\log n)$, n 是链表长度装载因子 $\alpha$

### 应用场景

{key, value} 哈希 map

key: 元素的值, value: 元素的某种属性

#### 设计 value

value 对应元素的属性, 常见的有

1. 次数: 元素的出现次数
2. 数组: 元素对应的信息是一组数据
3. 下标: 元素对应的下标
4. 坐标: 存储元素坐标
5. 其他: 根据实际需要构建 value

#### 设计 key

1. **多维数据**为 key

   由于 STL 的默认哈希函数不能处理多维数据, 所以要使用 STL 的默认哈希函数的话, 需要将多维数据转化为一维数据

2. 字母异位词为 key

   > 字母异位词: 字母相同, 排列不同

​		可以将字符串排好序作为 key

 3. **顺序不重要**时, 排好序后做 key

 4. 值的**偏移量**

    通常是相对于第一个元素的偏移量

 5. 树中偶尔可以用结点作为 key, 大多数时要将**序列化的结果/三元组/唯一标识**作为 key

 6. **矩阵**中

    1. 用行索引或列索引作为 key

    2. 矩阵分块时, 可用行列索引进行组合来分块

    3. 将矩阵**对角线**上的元素作为同一组, 利用对角线的性质

       1. 左下到右上对角线

          {key : value} : {i + j : val}

       2. 左上到右下对角线

          {key : value} : {i - j : val}

#### 滑动窗口优化

若窗口为 `"aaaabc"`, 想要让窗口变为 `"abc"`, 左边界需要移动 3 步

如果用哈希 map 记录 `{"a" : 3}`, 则一步就能移动到相应的位置

> 3 为下标

哈希表还能用来统计窗口内元素的个数

#### 哈希技巧

分组哈希

#### 字符串哈希(手动)

```C++
// 下标从 1 开始的字符串 s

typedef unsigned long long ULL;
const int N, P = 131;

ULL h[N], p[N];

// 处理得到哈希值
p[0] = 1;
for(int i = 1; i <= n; i++)
{
    h[i] = h[i - 1] * P + s[i];
    p[i] = p[i - 1] * P;
}

// 得到 s 的子字符串 s[l..r]
ULL get(int l, int r)
{
    return h[r] - h[l - 1] * p[r - l + 1];
}
```



## 题库

[设计哈希集合](https://leetcode.cn/problems/design-hashset/)		unordered_set 底层实现

[设计哈希映射](https://leetcode.cn/problems/design-hashmap/)		unordered_map 底层实现

[四数相加 II](https://leetcode.cn/problems/4sum-ii/)			分组哈希

[寻找重复的子树](https://leetcode.cn/problems/find-duplicate-subtrees/)	用三元组和 id 来唯一标识一个结构与值固定的子树

[单词替换](https://leetcode.cn/problems/replace-words/)				字符串哈希/trie 树
# 数据库

## 数据库基础

### 事务

执行的动作, 一个数据库操作序列

### 事务特性

* 原子性
* 一致性
* 隔离性
* 持久性

## B 树

### 定义

m 阶 B 树定义:

1. 每个节点最多 $m-1$ 个关键字
2. 每个节点最少 $\frac{m}{2} $ 个关键字, 根节点最少 1个关键字
3. 每个关键字的**左子树**的所有关键字**都小于它**, **右子树都大于它** 
4. 所有叶子节点位于同一层

### 插入

插入一条记录, 即 `(key, value)` 键值对, 如果已经存在 `key` 就更新 `value`

1. 根据二叉搜索树的做法找到**叶子结点并插入**
2. 若当前结点 `key` 的个数大于 `m-1`, 就**以当前结点关键字的中位数为中心分裂为左右两部分**, 然后将**中位数插入到父节点**中, 左子树指向左半部分, 右子树指向右半部分, 最后递归判断父结点是否满足条件

### 删除

删除 `key` 对应的记录

1. 若 `key` 在叶子节点, 则直接删除; 若 `key` 在非叶子结点, 则用 `key` 的后继 `key` 覆盖要删除的 `key`, 然后再删除后继 `key`

   > 后继 `key` 一定位于叶子结点

2. 若删除后当前结点 `key` 个数 $\geq m/2$, 则不需要操作
3. 否则, 若兄弟节点 `key` 个数 $> m/2$, 则父节点 `key` 下移到当前结点, 兄弟结点一个 `key` 上移
4. 否则, 父节点的 `key` 下移后于当前结点及相邻兄弟节点合并为一个新节点

## B+ 树

### 定义

1. **索引节点不保存数据**, 只用于索引, 所有数据保存在叶子结点
2. 每个结点 `key` 的**左子树都小于** `key`, **右子树都大于等于** `key`
3. **叶子节点**存储**指向下一叶子节点**的指针, 形成一条链表

> 内部节点也称为索引节点

### 插入

插入记录 `(key, value)`

1. 根据 `key` **插入到叶子节点**中, 若 `key` 个数小于等于 `m-1`, 则结束
2. 否则将叶子节点**分裂为左右两个部分**, **中位数进位**到父节点中
3. 对索引节点, 若 `key` 个数小于等于 `m-1` 则结束
4. 否则, 将**索引结点分裂**为左右两个部分, 中位数进位到父节点中

### 删除

删除 `key` 对应的记录

1. 删除叶子节点中的 `key`, 若删除后 `key` 个数大于等于 `m/2`, 则结束
2. 若兄弟结点 `key` 有富余, 则向兄弟节点借一个记录, 并更新父节点的索引 `key`
3. 若兄弟节点 `key` 无富余, 则跟兄弟节点合并为一个新叶子节点, 删除父节点的索引 `key`
4. 若索引节点 `key` 个数大于等于 `m/2`, 则结束
5. 若兄弟节点 `key` 有富余, 兄弟节点 `key` 上移, 父节点 `key` 下移
6. 若兄弟节点 `key` 无富余, 当前结点与兄弟节点和父节点下移 `key` 合并为一个新索引结点
